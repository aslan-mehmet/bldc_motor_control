/**
 * @file main.c
 * @author Mehmet ASLAN
 * @date December 4, 2017
 * @copyright Gnu General Public License Version 3 or Later
 * @brief test slope library for real time plotting 
 */
#include <math.h>
#include <slope/slope.h>

#define X_LEN 1000
#define DT ((double) 1.0e-03)

SlopeScale *scale;
SlopeItem *series;
GtkWidget *chart;

double x_min, x_max;
int indx = 0, n_pts = 0;

void push(void)
{
	if (indx == X_LEN) {
		indx = 0;
	}

	x[indx] = n_pts;
	
	++n_pts;
}


static gboolean timer_callback(GtkWidget *chart)
{

	slope_xyscale_set_x_range(SLOPE_XYSCALE(scale), x_min, x_max);
//	slope_xyseries_update(SLOPE_XYSERIES(series));
	slope_chart_redraw(SLOPE_CHART(chart));
	return TRUE;
}

int main(int argc, char **argv)
{
	init();
	
	gtk_init(NULL, NULL);
	
	chart = slope_chart_new(); // so gtkwidget

	g_signal_connect(G_OBJECT(chart), "destroy", G_CALLBACK(gtk_main_quit), NULL); // what object in c, I know

	scale = slope_xyscale_new_axis("time", "mag", "sine wave"); // seems like creating new obj

	slope_xyscale_set_x_range(SLOPE_XYSCALE(scale), x_min, x_max);
	slope_xyscale_set_y_range(SLOPE_XYSCALE(scale), -1, 1);

	slope_chart_add_scale(SLOPE_CHART(chart), scale);

	series = slope_xyseries_new_filled("legend", x, y, LEN, "b-"); // guess b- line style

	slope_scale_add_item(scale, series);

	g_timeout_add(100, (GSourceFunc) timer_callback, (gpointer) chart); // this ui thingy
	
	gtk_widget_show_all(chart);

	gtk_main();

	return 0;
}
